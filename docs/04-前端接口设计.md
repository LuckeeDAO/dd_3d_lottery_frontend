# DD 3D 彩票前端 接口设计文档

## 📋 文档信息

- **项目名称**: DD 3D Lottery Frontend (3D彩票前端应用)
- **版本**: v1.0.0
- **文档类型**: 前端接口设计文档
- **创建日期**: 2024-01-XX
- **最后更新**: 2024-01-XX

## 🎯 概述

本文档定义了DD 3D Lottery前端应用的所有接口规范，包括钱包接口、合约接口、API接口、组件接口等，确保前后端交互的一致性和可靠性。

## 🔌 钱包接口

### 1.1 钱包连接接口

```typescript
// types/wallet.ts
export enum WalletType {
  KEPLR = 'keplr',
  COSMOSTATION = 'cosmostation',
  LEAP = 'leap'
}

export interface WalletInfo {
  type: WalletType;
  address: string;
  pubKey: Uint8Array;
  algo: string;
  isNanoLedger: boolean;
}

export interface AccountInfo {
  address: string;
  pubKey: Uint8Array;
  algo: string;
  isNanoLedger: boolean;
}

export interface Balance {
  denom: string;
  amount: string;
}

export interface WalletService {
  // 连接钱包
  connect(walletType: WalletType): Promise<WalletInfo>;
  
  // 断开连接
  disconnect(): Promise<void>;
  
  // 获取账户信息
  getAccount(): Promise<AccountInfo>;
  
  // 获取余额
  getBalance(denom: string): Promise<Balance>;
  
  // 发送交易
  sendTransaction(tx: Transaction): Promise<TransactionResult>;
  
  // 签名消息
  signMessage(message: string): Promise<string>;
  
  // 监听事件
  on(event: string, callback: Function): void;
  off(event: string, callback: Function): void;
}
```

### 1.2 钱包事件接口

```typescript
// 钱包事件类型
export interface WalletEvents {
  // 连接事件
  connected: (info: WalletInfo) => void;
  
  // 断开事件
  disconnected: () => void;
  
  // 账户变更事件
  accountChanged: (account: AccountInfo) => void;
  
  // 余额变更事件
  balanceChanged: (balance: Balance) => void;
  
  // 网络变更事件
  networkChanged: (network: string) => void;
  
  // 错误事件
  error: (error: WalletError) => void;
}

// 钱包错误类型
export interface WalletError {
  code: string;
  message: string;
  details?: any;
}
```

## 📡 合约接口

### 2.1 合约查询接口

```typescript
// types/contract.ts
export interface ContractQuery {
  // 查询当前会话
  getCurrentSession(): Promise<LotterySession>;
  
  // 查询参与者信息
  getParticipantInfo(participant: string): Promise<ParticipantInfo>;
  
  // 查询彩票结果
  getLotteryResult(sessionId: string): Promise<LotteryResult>;
  
  // 查询当前阶段
  getCurrentPhase(): Promise<PhaseInfo>;
  
  // 查询合约配置
  getConfig(): Promise<ContractConfig>;
  
  // 查询彩票历史
  getLotteryHistory(limit?: number, startAfter?: string): Promise<LotteryResult[]>;
  
  // 查询参与者列表
  getParticipants(): Promise<Participant[]>;
  
  // 查询统计信息
  getStats(): Promise<StatsInfo>;
  
  // 查询版本信息
  getVersion(): Promise<VersionInfo>;
}
```

### 2.2 合约执行接口

```typescript
// 合约执行接口
export interface ContractExecute {
  // 投注操作
  placeBet(commitmentHash: string): Promise<TransactionResult>;
  
  // 揭秘操作
  revealRandom(luckyNumbers: number[], randomSeed: string): Promise<TransactionResult>;
  
  // 结算操作
  settleLottery(): Promise<TransactionResult>;
  
  // 管理员操作
  updateConfig(config: Partial<ContractConfig>): Promise<TransactionResult>;
  emergencyPause(paused: boolean): Promise<TransactionResult>;
  withdrawServiceFee(amount: string): Promise<TransactionResult>;
}
```

### 2.3 数据模型接口

```typescript
// types/lottery.ts
export enum LotteryPhase {
  COMMITMENT = 'commitment',
  REVEAL = 'reveal',
  SETTLEMENT = 'settlement'
}

export interface LotterySession {
  sessionId: string;
  phase: LotteryPhase;
  totalPool: string;
  serviceFee: string;
  participants: Participant[];
  createdHeight: number;
  winningNumber?: number;
  settled: boolean;
}

export interface Participant {
  address: string;
  betAmount: string;
  betNumber: number;
  betMultiplier: number;
  randomSeed?: string;
  revealed: boolean;
  commitmentHash?: string;
}

export interface ParticipantInfo {
  address: string;
  betAmount: string;
  betNumber: number;
  betMultiplier: number;
  randomSeed?: string;
  revealed: boolean;
  commitmentHash?: string;
}

export interface LotteryResult {
  sessionId: string;
  winningNumber: number;
  winners: Winner[];
  totalRewards: string;
  settledHeight: number;
}

export interface Winner {
  address: string;
  rewardAmount: string;
  betNumber: number;
}

export interface PhaseInfo {
  phase: LotteryPhase;
  blockHeight: number;
  phaseMod: number;
}

export interface ContractConfig {
  admin: string;
  serviceFeeRate: string;
  minBetAmount: string;
  maxBetAmount: string;
  betDenom: string;
  paused: boolean;
  pauseRequested: boolean;
}

export interface StatsInfo {
  totalSessions: number;
  totalParticipants: number;
  totalPool: string;
  totalServiceFee: string;
  totalRewards: string;
}

export interface VersionInfo {
  contractName: string;
  contractVersion: string;
}
```

## 🎣 自定义Hooks接口

### 3.1 useWallet Hook接口

```typescript
// hooks/useWallet.ts
export interface UseWalletReturn {
  // 状态
  connected: boolean;
  address: string | null;
  balance: Balance | null;
  network: string;
  loading: boolean;
  
  // 操作
  connect: (walletType: WalletType) => Promise<void>;
  disconnect: () => Promise<void>;
  
  // 查询
  getAccount: () => Promise<AccountInfo>;
  getBalance: (denom: string) => Promise<Balance>;
  
  // 交易
  sendTransaction: (tx: Transaction) => Promise<TransactionResult>;
  signMessage: (message: string) => Promise<string>;
}
```

### 3.2 useLottery Hook接口

```typescript
// hooks/useLottery.ts
export interface UseLotteryReturn {
  // 状态
  currentSession: LotterySession | null;
  phase: LotteryPhase;
  timeRemaining: number;
  participantInfo: ParticipantInfo | null;
  loading: boolean;
  
  // 操作
  placeBet: (data: PlaceBetData) => Promise<void>;
  revealRandom: (data: RevealData) => Promise<void>;
  settleLottery: () => Promise<void>;
  
  // 查询
  getCurrentSession: () => Promise<LotterySession>;
  getParticipantInfo: (address: string) => Promise<ParticipantInfo>;
  getLotteryResult: (sessionId: string) => Promise<LotteryResult>;
}

export interface PlaceBetData {
  betAmount: number;
  luckyNumbers: number[];
  randomSeed: string;
}

export interface RevealData {
  luckyNumbers: number[];
  randomSeed: string;
}
```

### 3.3 useContract Hook接口

```typescript
// hooks/useContract.ts
export interface UseContractReturn {
  // 查询方法
  getCurrentSession: () => Promise<LotterySession>;
  getParticipantInfo: (address: string) => Promise<ParticipantInfo>;
  getLotteryResult: (sessionId: string) => Promise<LotteryResult>;
  getCurrentPhase: () => Promise<PhaseInfo>;
  getConfig: () => Promise<ContractConfig>;
  getLotteryHistory: (limit?: number, startAfter?: string) => Promise<LotteryResult[]>;
  getParticipants: () => Promise<Participant[]>;
  getStats: () => Promise<StatsInfo>;
  getVersion: () => Promise<VersionInfo>;
  
  // 执行方法
  placeBet: (commitmentHash: string) => Promise<TransactionResult>;
  revealRandom: (luckyNumbers: number[], randomSeed: string) => Promise<TransactionResult>;
  settleLottery: () => Promise<TransactionResult>;
  updateConfig: (config: Partial<ContractConfig>) => Promise<TransactionResult>;
  emergencyPause: (paused: boolean) => Promise<TransactionResult>;
  withdrawServiceFee: (amount: string) => Promise<TransactionResult>;
  
  // 状态
  loading: boolean;
  error: string | null;
}
```

## 🧩 组件接口

### 4.1 基础UI组件接口

```typescript
// components/ui/Button.tsx
export interface ButtonProps extends React.ButtonHTMLAttributes<HTMLButtonElement> {
  variant?: 'default' | 'destructive' | 'outline' | 'secondary' | 'ghost' | 'link';
  size?: 'default' | 'sm' | 'lg' | 'icon';
  loading?: boolean;
  asChild?: boolean;
}

// components/ui/Input.tsx
export interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  label?: string;
  error?: string;
  helper?: string;
}

// components/ui/Card.tsx
export interface CardProps extends React.HTMLAttributes<HTMLDivElement> {
  variant?: 'default' | 'outlined' | 'elevated';
}

// components/ui/Badge.tsx
export interface BadgeProps extends React.HTMLAttributes<HTMLDivElement> {
  variant?: 'default' | 'secondary' | 'destructive' | 'outline';
  size?: 'sm' | 'md' | 'lg';
}
```

### 4.2 钱包组件接口

```typescript
// components/wallet/WalletConnect.tsx
export interface WalletConnectProps {
  onConnect?: (wallet: WalletInfo) => void;
  onDisconnect?: () => void;
  onError?: (error: WalletError) => void;
}

// components/wallet/WalletStatus.tsx
export interface WalletStatusProps {
  showBalance?: boolean;
  showNetwork?: boolean;
  compact?: boolean;
}

// components/wallet/WalletButton.tsx
export interface WalletButtonProps extends ButtonProps {
  walletType: WalletType;
  onConnect?: (wallet: WalletInfo) => void;
  onError?: (error: WalletError) => void;
}
```

### 4.3 彩票组件接口

```typescript
// components/lottery/LotteryPhase.tsx
export interface LotteryPhaseProps {
  showTimeRemaining?: boolean;
  showSessionInfo?: boolean;
  compact?: boolean;
}

// components/lottery/BetForm.tsx
export interface BetFormProps {
  onSubmit?: (data: PlaceBetData) => void;
  onCancel?: () => void;
  loading?: boolean;
  disabled?: boolean;
}

// components/lottery/RevealForm.tsx
export interface RevealFormProps {
  onSubmit?: (data: RevealData) => void;
  onCancel?: () => void;
  loading?: boolean;
  disabled?: boolean;
}

// components/lottery/ResultDisplay.tsx
export interface ResultDisplayProps {
  result: LotteryResult;
  showWinners?: boolean;
  showRewards?: boolean;
  compact?: boolean;
}

// components/lottery/HistoryList.tsx
export interface HistoryListProps {
  results: LotteryResult[];
  loading?: boolean;
  onLoadMore?: () => void;
  hasMore?: boolean;
}
```

## 🔄 状态管理接口

### 5.1 Zustand Store接口

```typescript
// stores/walletStore.ts
export interface WalletStore {
  // 状态
  connected: boolean;
  address: string | null;
  balance: Balance | null;
  network: string;
  walletType: WalletType | null;
  
  // 操作
  setConnected: (connected: boolean) => void;
  setAddress: (address: string | null) => void;
  setBalance: (balance: Balance | null) => void;
  setNetwork: (network: string) => void;
  setWalletType: (type: WalletType | null) => void;
  reset: () => void;
}

// stores/lotteryStore.ts
export interface LotteryStore {
  // 状态
  currentSession: LotterySession | null;
  phase: LotteryPhase;
  participantInfo: ParticipantInfo | null;
  history: LotteryResult[];
  
  // 操作
  setCurrentSession: (session: LotterySession | null) => void;
  setPhase: (phase: LotteryPhase) => void;
  setParticipantInfo: (info: ParticipantInfo | null) => void;
  addToHistory: (result: LotteryResult) => void;
  clearHistory: () => void;
}

// stores/uiStore.ts
export interface UIStore {
  // 状态
  loading: boolean;
  error: string | null;
  theme: 'light' | 'dark';
  language: 'zh' | 'en';
  sidebarOpen: boolean;
  
  // 操作
  setLoading: (loading: boolean) => void;
  setError: (error: string | null) => void;
  setTheme: (theme: 'light' | 'dark') => void;
  setLanguage: (language: 'zh' | 'en') => void;
  setSidebarOpen: (open: boolean) => void;
  toggleSidebar: () => void;
}
```

### 5.2 React Query接口

```typescript
// 查询键定义
export const queryKeys = {
  wallet: ['wallet'] as const,
  account: () => [...queryKeys.wallet, 'account'] as const,
  balance: () => [...queryKeys.wallet, 'balance'] as const,
  
  lottery: ['lottery'] as const,
  currentSession: () => [...queryKeys.lottery, 'currentSession'] as const,
  participantInfo: (address: string) => [...queryKeys.lottery, 'participantInfo', address] as const,
  lotteryResult: (sessionId: string) => [...queryKeys.lottery, 'result', sessionId] as const,
  lotteryHistory: () => [...queryKeys.lottery, 'history'] as const,
  
  contract: ['contract'] as const,
  config: () => [...queryKeys.contract, 'config'] as const,
  stats: () => [...queryKeys.contract, 'stats'] as const,
  version: () => [...queryKeys.contract, 'version'] as const,
} as const;

// 查询配置
export const queryConfig = {
  defaultOptions: {
    queries: {
      refetchOnWindowFocus: false,
      retry: 3,
      staleTime: 5 * 60 * 1000, // 5分钟
      cacheTime: 10 * 60 * 1000, // 10分钟
    },
  },
} as const;
```

## 🌐 API接口

### 6.1 外部API接口

```typescript
// services/api/apiService.ts
export interface APIService {
  // 获取代币价格
  getTokenPrice(symbol: string): Promise<TokenPrice>;
  
  // 获取交易历史
  getTransactionHistory(address: string, limit?: number): Promise<Transaction[]>;
  
  // 获取区块信息
  getBlockInfo(height: number): Promise<BlockInfo>;
  
  // 获取网络状态
  getNetworkStatus(): Promise<NetworkStatus>;
}

export interface TokenPrice {
  symbol: string;
  price: number;
  change24h: number;
  marketCap: number;
  volume24h: number;
}

export interface Transaction {
  hash: string;
  height: number;
  timestamp: number;
  from: string;
  to: string;
  amount: string;
  denom: string;
  status: 'success' | 'failed' | 'pending';
}

export interface BlockInfo {
  height: number;
  timestamp: number;
  proposer: string;
  transactions: number;
  gasUsed: number;
  gasLimit: number;
}

export interface NetworkStatus {
  online: boolean;
  blockHeight: number;
  peers: number;
  syncStatus: 'synced' | 'syncing' | 'behind';
}
```

### 6.2 本地存储接口

```typescript
// services/storage/storageService.ts
export interface StorageService {
  // 设置值
  setItem(key: string, value: any): void;
  
  // 获取值
  getItem<T>(key: string): T | null;
  
  // 删除值
  removeItem(key: string): void;
  
  // 清空存储
  clear(): void;
  
  // 监听变化
  onChanged(callback: (changes: StorageChange) => void): void;
}

export interface StorageChange {
  key: string;
  oldValue: any;
  newValue: any;
}

// 存储键定义
export const storageKeys = {
  WALLET_ADDRESS: 'wallet_address',
  WALLET_TYPE: 'wallet_type',
  THEME: 'theme',
  LANGUAGE: 'language',
  SIDEBAR_OPEN: 'sidebar_open',
  LAST_SESSION: 'last_session',
} as const;
```

## 🎨 主题接口

### 7.1 主题配置接口

```typescript
// components/theme/ThemeProvider.tsx
export interface ThemeConfig {
  colors: {
    primary: string;
    secondary: string;
    success: string;
    warning: string;
    error: string;
    background: string;
    surface: string;
    text: string;
  };
  
  typography: {
    fontFamily: string;
    fontSize: {
      xs: string;
      sm: string;
      base: string;
      lg: string;
      xl: string;
      '2xl': string;
      '3xl': string;
    };
  };
  
  spacing: {
    xs: string;
    sm: string;
    md: string;
    lg: string;
    xl: string;
    '2xl': string;
  };
  
  breakpoints: {
    sm: string;
    md: string;
    lg: string;
    xl: string;
    '2xl': string;
  };
}

export interface ThemeProviderProps {
  children: React.ReactNode;
  defaultTheme?: 'light' | 'dark';
  storageKey?: string;
}
```

### 7.2 主题Hook接口

```typescript
// hooks/useTheme.ts
export interface UseThemeReturn {
  theme: 'light' | 'dark';
  setTheme: (theme: 'light' | 'dark') => void;
  toggleTheme: () => void;
  systemTheme: 'light' | 'dark';
  resolvedTheme: 'light' | 'dark';
}
```

## 🔧 工具函数接口

### 8.1 验证函数接口

```typescript
// utils/validators.ts
export interface Validators {
  // 地址验证
  isValidAddress(address: string): boolean;
  
  // 金额验证
  isValidAmount(amount: string): boolean;
  
  // 幸运数字验证
  isValidLuckyNumber(number: number): boolean;
  
  // 随机种子验证
  isValidRandomSeed(seed: string): boolean;
  
  // 承诺哈希验证
  isValidCommitmentHash(hash: string): boolean;
}

// 验证结果
export interface ValidationResult {
  valid: boolean;
  error?: string;
}
```

### 8.2 格式化函数接口

```typescript
// utils/formatters.ts
export interface Formatters {
  // 格式化地址
  formatAddress(address: string, length?: number): string;
  
  // 格式化金额
  formatAmount(amount: string, decimals?: number): string;
  
  // 格式化时间
  formatTime(timestamp: number): string;
  
  // 格式化阶段
  formatPhase(phase: LotteryPhase): string;
  
  // 格式化百分比
  formatPercentage(value: number, decimals?: number): string;
}
```

### 8.3 工具函数接口

```typescript
// utils/helpers.ts
export interface Helpers {
  // 生成随机数
  generateRandomNumber(min: number, max: number): number;
  
  // 生成随机字符串
  generateRandomString(length: number): string;
  
  // 生成承诺哈希
  generateCommitmentHash(data: any): string;
  
  // 延迟函数
  delay(ms: number): Promise<void>;
  
  // 防抖函数
  debounce<T extends (...args: any[]) => any>(
    func: T,
    wait: number
  ): (...args: Parameters<T>) => void;
  
  // 节流函数
  throttle<T extends (...args: any[]) => any>(
    func: T,
    wait: number
  ): (...args: Parameters<T>) => void;
}
```

## 📊 错误处理接口

### 9.1 错误类型接口

```typescript
// types/errors.ts
export interface AppError {
  code: string;
  message: string;
  details?: any;
  timestamp: number;
}

export interface WalletError extends AppError {
  type: 'wallet';
  walletType?: WalletType;
}

export interface ContractError extends AppError {
  type: 'contract';
  method?: string;
  params?: any;
}

export interface NetworkError extends AppError {
  type: 'network';
  url?: string;
  status?: number;
}

export interface ValidationError extends AppError {
  type: 'validation';
  field?: string;
  value?: any;
}
```

### 9.2 错误处理接口

```typescript
// utils/errorHandler.ts
export interface ErrorHandler {
  // 处理错误
  handleError(error: Error): void;
  
  // 显示错误
  showError(error: AppError): void;
  
  // 记录错误
  logError(error: AppError): void;
  
  // 获取错误消息
  getErrorMessage(error: AppError): string;
  
  // 判断错误类型
  isWalletError(error: any): error is WalletError;
  isContractError(error: any): error is ContractError;
  isNetworkError(error: any): error is NetworkError;
  isValidationError(error: any): error is ValidationError;
}
```

## 📝 变更记录

| 版本 | 日期 | 变更内容 | 变更人 |
|------|------|----------|--------|
| v1.0 | 2024-01-XX | 初始接口设计文档创建 | AI Assistant |

---

**注意**: 本文档定义了DD 3D彩票前端应用的所有接口规范，所有开发工作都必须基于此文档进行。
